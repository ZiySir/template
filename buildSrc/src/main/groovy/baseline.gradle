plugins {
    id 'java'
    // 代码检查插件
    id 'com.palantir.baseline-error-prone'
    id 'com.palantir.baseline-checkstyle'

    // 代码自动格式化插件
    id 'com.diffplug.spotless'
    id 'com.palantir.java-format' // palantir风格

    // 其他palantir baseline系列插件
    id 'com.palantir.baseline-exact-dependencies' // 帮助优化依赖关系
}

// 这些插件：需要用apply plugin.
apply plugin: 'com.palantir.baseline-encoding'
apply plugin: 'com.palantir.baseline-immutables'

// 代码自动格式化配置.
spotless {
    java {
        lineEndings com.diffplug.spotless.LineEnding.UNIX
        endWithNewline()
        indentWithSpaces 4
        trimTrailingWhitespace()
        custom 'Lambda fix', { it.replace('} )', '})').replace('} ,', '},') }
    }
    groovyGradle {
        greclipse()
    }
}

tasks.withType(JavaCompile).configureEach(new Action<Task>() {
    void execute(Task task) {
        // 禁止baseline errorprone编译规则
//        task.options.errorprone.disable 'InvalidBlockTag', 'StrictUnusedVariable', 'EmptyCatch'
    }
})
